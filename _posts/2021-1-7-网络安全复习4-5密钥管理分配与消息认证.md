---
title: 4-5密钥管理分配与消息认证
date: "2021-1-7 2:05:00 +0800"
tags: [网络安全复习]
---

# 密钥管理与分配
>>>
    窃取密钥代价远低于破译密码算法

## 基本概念
密钥管理是一种指导密钥生命期内相关技术问题的安全策略，以抵御各种潜在的威胁
+ 密钥生命期：密钥产生、存储、分配、使用、更换、撤销和销毁
+ 威胁：密钥泄漏，密钥失效，未授权滥用
## 对称密码体制的密钥管理
### 密钥分级
+ 初级密钥：加解密实际数据
  + 初级文件密钥：生存周期与其保护的文件一样长
  + 初级通信（会话）密钥：一个密钥使用一次或多次，生存周期很短（原则上一次一密）
+ 二级密钥：保护初级密钥
+ 主密钥：保护二级密钥进行
  + 最高级密钥
  + 生存周期很长
### 密钥产生
+ 方式：手工/自动
+ 基本要求：良好随机性、不可预测性等，包括
  + 长周期性、非线性、统计上等概率性。 
+ 困难性：
  + 选择密钥方式不当会影响安全性
  + 差的选择方式易受字典式攻击
#### 分级密钥产生
+ 主密钥的产生
  + 物理噪声源产生真随机序列。  
+ 二级密钥的产生 
  + 随机数发生器
  + 主密钥+强密码算法
+ 初级密钥的产生
  + 把随机数视为受高级密钥（主、二级密钥）加密后的初级密钥，解密得初级密钥。 
  + K初=$D_{k高}(R)$
### 密钥存储形态
+ 明文形态: 密钥以明文形式存储；
+ 密文形态: 密钥被加密后存储；
+ 分量形态: 密钥以分量的形式存储（门限方案）
#### 分级密钥存储 
+ 主密钥的存储
  + 明文存储
  + 存储器必须高度安全：物理上安全，逻辑上安全。通常专用密码装置。
  + 或分量存储
+ 二级密钥的存储 
  + 主密钥加密存储
+ 初级密钥的存储 
  + 二级密钥加密存储 
  + 存储空间是工作存储器，应当确保工作存储器的安全 
#### 门限密钥保存方案
也称秘密共享或秘密分享。将秘密（密钥）被分割成几份，一定份额结合才能恢复秘密。
+ Shamir建议方案：
  + 把密钥按某方法分为W个子密钥K1、K2、… 、KW，并分发给W个人；
  + 任意t个子密钥计算密钥K容易；
  + 少于t个的子密钥计算密钥K理论上不可解
#### 秘密共享
两人的密钥通过异或获取
#### 密钥分配技术（协议）
+ 密钥分发协议：系统内的一个成员选择密钥，然后将它们安全传给其他成员
+ 密钥协定（商）协议：
  + 系统两个或者多个成员在公开的信道上联合建立秘密密钥。
  + 两个成员的密钥协定也称为密钥交换
#### 密钥分配体制
+ 集中式：基于中心服务器
+ 分布式：用户之间直接密钥交换
#### 密钥分配基本方法
+ 利用人工信道实现: 信使、信函、信鸽、电话
+ 网络分配密钥方式
+ 利用物理现象，如量子密码学
## 密钥分配技术
+ 直接分配（分布式）
+ 密钥分配中心KDC方式(当前的主流方式)
  + KDC与每个用户共享一个密钥加密密钥（二级）；
  + 用户向KDC申请会话密钥；
  + KDC生成会话密钥；
  + KDC用密钥加密密钥加密会话密钥分发给用户
  + 优点：
    + 用户不保存工作密钥，可实现一报一密；
  + 缺点：
    + 通信量大，需较好的鉴别功能，以识别KDC和用户。
+ Diffie-Hellman方法（使两个用户安全地交换密钥，得到共享会话密钥）
+ 分级密钥分配
  + 主密钥的分配 
    + 最安全分配方法：人工分配，由专职密钥分配人员分配并由专职安装人员妥善安装。 
  + 二级密钥的分配 
    + 主密钥对二级密钥进行加密保护；
    + 利用计算机网络自动传输分配。
  + 初级密钥的分配 
    + 把一随机数视为一初级密钥被高级密钥加密后的密文。
    + 发送方把随机数（密文形式的初级密钥）通过网络传给对方，接收端用高级密钥解密获取初级密钥
### 利用公钥密码体制来分配密钥
#### 具有保密性和认证的分配方法
+ 通信双方不负责公钥的分发（由PKI实施）
+ 密钥交换前双方已获取对方公钥
#### 密钥的寿命
+ 密钥不能无限期使用
+ 密钥必须定期更换
+ 分级密钥
+ 公开密钥密码体制的私钥的寿命
## 公钥管理与分配——PKI
### 公钥管理问题的提出——中间人攻击
中间人伪造公钥（假冒）破坏公钥完整性、真实性
### 公钥管理解决方案
+ 将公钥与身份绑定
  + 数字（公钥）证书
+ 由可信第三方做担保
  + 权威机构（CA）管理、签名（盖章）、颁发
+ 其他用户（公钥使用者）验证证书
  + 验证签名
### 公钥证书
+ 数据结构
  + **用户标识**
  + **公钥**
  + **CA签名**
+ 存储和分配无需保护
  + 用户通过公钥证书交换各自公钥  
### 证书的类型
+ 从证书的最终使用者看，
  + 系统证书，CA系统自身的证书
  + 用户证书，各种用户的证书
+ 从证书的用途来看，
  + 签名证书，对用户信息进行签名，确保不可否认性
  + 加密证书，对用户传输信息进行加密，确保真实性，完整性
+ 在使用中必须为用户配置两对密钥（加密、签名）和相应的证书
### 证书验证
+ CA在证书上签名，CA数字签名被验证是正确的
+ 证书有良好的完整性，证书hash值一致
+ 证书处于有效期内
+ 证书没有被撤消
+ 证书的使用方式与声明的策略和使用限制相一致
### 数字信封+签名
+ 用自己的私钥签名文件（文件hash数字摘要）
+ 发送方生成会话密钥ks，加密文件
+ 获取对方公钥证书，用对方公钥加密ks
+ 将数字信封（签名+密文+加密后会话密码）发送给对方
### PKI(Pubic Key Infrastructure)公钥基础设施
![pki](/assets/resource/网络安全复习/pki.png)
#### 证书机构
CA，Certificate Authority：PKI核心
+ 可信第三方实体：国家认定的权威机构，受用户信任。
+ 两类：
  + 公共CA：通过internet为大众提供认证服务
  + 私有CA：公司或组织内部
+ CA功能:负责用户密钥或证书发放、更新、废止、认证等管理工作
+ 密钥管理：密钥产生、备份与恢复以及密钥更新。
+ 颁发证书
  + 检验公钥是否合法
  + 审查认证实体的身份
  + 签发证书
+ 证书验证：
  + 验证有效性、可用性与真实性。
+ 废除、更新证书
  + 私钥泄漏或证书过期，用户申请更新私钥和更新证书，并废除原证书。
#### 注册机构
RA，Registration Authority
当实体数量增加，充当CA和用户的中间实体，辅助CA来完成一些证书处理功能
1. 接收和验证新注册用户的注册信息；
2. 代表最终用户生成密钥；
3. 接收和处理密钥备份和恢复请求；
4. 接收和处理证书撤销请求
#### 证书颁发系统CDA
颁发证书,用户自己发布，或通过目录服务器向外发布
### PKI的体系结构
#### 单CA结构
**基本结构**: sCA为PKI中所有用户提供PKI服务所有用户信任CA
#### 层次结构
CA将权利授予一个或多个子CA。子CA再指派子CA，直到某级CA实际颁发用户证书
![pki层级](/assets/resource/网络安全复习/pki层级.png)
#### 交叉认证结构
当两者隶属于不同CA，通过信任传递建立横向信任关系——双边（对等）信任关系
![pki交叉](/assets/resource/网络安全复习/pki交叉.png)
#### 混合（Hybrid）结构
层次结构同交叉认证结构的结合
#### 证书链
由一系列 CA 签发的证书序列，最终以根 CA 证书结束

# 第5章 消息认证与数字签名
## 消息认证
+ 消息接收者验证消息来源真实性和消息完整性的过程，
  + 真实性：发送者真实非假冒——信源鉴别；
  + 完整性：消息在传送或存储过程中没被篡改、重放、乱序或延迟等；
### 消息认证模型
+ 三元组（K,T,V)
  + 密钥生成算法K
  + 标签算法T
  + 验证算法V
![认证](/assets/resource/网络安全复习/认证.png)
### 认证（鉴别）函数
+ 认证编码器、译码器抽象为认证函数
  + 发送方产生一个认证标识（Authentication Identification）
  + 给出合理认证协议(Authentication Protocol)
  + 接收者完成消息的鉴别（Authentication）
### 认证函数
+ 消息加密函数(Message encryption)
  + 用完整信息的密文作为对信息的认证。
+ 消息认证码MAC(Message Authentication Code)
  + 对信源信息的一个编码函数
  + 公开函数+**共享密钥**产生一个固定长度的值作为认证标识
+ 散列函数(Hash Function)
  + 数字指纹（公开的函数），它将任意长的信息映射成一个固定长度的信息。
### 消息加密函数
消息自身加密作为**认证度量**
+ 缺点：认证标识（完整密文）与消息
+ 消息认证码（MAC）
+ 发送方使用K生成一个固定大小的短数据块，并将该数据块附加到消息后面
  + MAC＝Ck（M）
  + send：M+MAC
+ 接收方接收到消息M`+MAC，使用K生成
+ MAC函数类似于加密函数，但固定大小
  + 优点：认证标识（码）大小固定且短
  + 缺点：需要密钥，不需要从MAC解密出m
有没有不需密钥就能生成定长且短的认证标识的方法呢？---**hash**
#### 安全HASH函数要求
+ 任意长度数据块，产生固定长度散列值
+ 安全性，冲突（碰撞）一定存在，但发现困难
#### Hash函数的分类——根据安全水平
+ 弱无碰撞
  + 对给定消息x ∈ X，在计算上几乎找不到异于x的x' ∈ X使h(x)=h(x')。
+ 强无碰撞
  + 在计算上几乎不可能找到相异的x，x'使得h(x)=h(x')。
#### 几种常用的HASH算法
+ MD5
  + 输入：512bit块
  + 输出：128bit
  + 2004年国际密码学会议（Crypto’2004）山东大学王小云教授做了破译MD5（**不安全**）
+ SHA-1
+ RIPEMD-160
### 数字签名
+ （无签名）消息认证保证完整性/真实性, 不保证不可否认性
+ 五元组(M, C, K, S, V)（对应密码算法五元组）
  + M：所有消息组成的有限集
  + C：所有可能的签名组成的有限集
  + K：所有可能的密钥组成的有限集
  + S：签名算法
  + V：验证算法
#### 数字签名设计要求
+ 签名是被签名信息的相关二进制串；
+ 签名必须使用签名者唯一的信息；
+ 容易生成数字签名；
+ 容易验证数字签名；
+ 伪造签名计算上不可行
+ 在存储器中保存数字签名副本可行
#### 数字签名分类
+ 以方式分
  + 直接数字签名
    + 签名有效性依赖于签名私钥的安全性；(缺点)
      + 发方私钥丢失或被盗用，攻击者就可以伪造签名。
      + 发送方抵赖：声称私有密钥丢失或被窃，他人伪造签名；
    + 改进：
      + 签名包含时间戳，并要求私钥暴露及时报告给授权中心；
    + 敌方可伪造早于或等于时间T的时间戳：
      + 时间戳不可信，签名者可自己加时间戳（伪造）
  + 仲裁数字签名
    + 引入仲裁者
      + 发送方将签名消息首先送到仲裁者；
      + 仲裁者测试消息及其签名，以检查其来源和内容；
      + 然后将消息加上时间戳，并与仲裁验证通过指示一起发给接收者。
    + 仲裁者扮演敏感和关键角色。
      + 所有参与者必须极大地相信这一仲裁机制工作正常。（trusted system）
+ 以安全性分
  + 无条件安全的数字签名
  + 计算上安全的数字签名
+ 以可签名次数分
  + 一次性的数字签名
  + 多次性的数字签名
#### 数字签名算法
+ 普通数字签名算法
  + RSA 
  + EIGamal 
  + DSS/DSA
+ 群签名算法（投标）
  + 群中各个成员以群的名义匿名地签发消息，特性：
    + 只有群成员能代表所在的群签名
    + 接收者能验证签名所在的群，但不知道签名者
+ 盲签名算法
  + 保护消息内容对签名者不可见
  + Chaum1983年提出，电子商务领域广泛应用：
    + 电子货币：电子现金须加银行数字签名才能生效，盲签名保护消费者的匿名性；
    + 电子选举：选民提交的选票须盖上选委会的数字签名才合法，盲签名保护选民匿名性。
  + 盲签名性质:
    + 签名者不知道其所签名的消息的具体内容。
    + 签名消息不可追踪，即当签名消息被公布后，签名者无法知道这是他哪次的签署的
  + 盲签名步骤
    + 盲化：消息发送者先将消息盲化
    + 签名：让签名者对盲化的消息进行签名
    + s去盲：消息拥有者对签名除去盲因子，得到签名者关于原消息的签名
#### 消息认证与数字签名的区别
+ **消息认证**：验证消息真实性及完整性，防范第三者；
+ **数字签名**：收发双方产生利害冲突时，防止纠纷。
